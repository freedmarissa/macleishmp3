---
title: "Markdown File"
author: "Marissa Freed, Natasha Rosenthal, Maggie Welsh"
date: "3/26/2018"
output: 
  html_document:
    code_folding: hide
    df_print: paged
    fig_width: 10
    fig_length: 8
---
**make sure you `install.packages("macleish")` and `install.packages("leaflet")` before running code

http://download.massgis.digital.mass.gov/shapefiles/contours5k/hp337.zip


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(macleish)
library(leaflet)
library(sf)
proj4_aea <- "+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"
```

##Prompt: 
MacLeish currently has two campsites - one large group site closer to the building and one remote campsite with two tent platforms about one mile from the parking area. We would like to develop one additional campsite that is:
  1. Approximately 500 feet (805 meters) walk from the parking area
  2. Within 200 feet (61 meters) of a stream or other source of water
  3. In forest that is unlike the forest in the two other campsites 
  4. Relatively flat
  5. At least 500 feet (152 meters) from any research area or any element of the Challenge Course. 

Propose two new campsite locations for our consideration.

### Set up code:
```{r, warning=FALSE}
macleish_landmarks <- macleish_layers[["landmarks"]]
macleish_trails <- macleish_layers[["trails"]]
macleish_streams <- macleish_layers[["streams"]]
macleish_forests <- macleish_layers[["forests"]]
macleish_courses <- macleish_layers[["challenge_courses"]]
macleish_boundary <- macleish_layers[["boundary"]]
macleish_contours <- macleish_layers[["contours_3m"]]
macleish_research <- macleish_layers[["research"]]
macleish_buildings <- macleish_layers[["buildings"]]
parking <- data.frame(lat = 42.448013, lon = -72.680663)
camp1 <- data.frame(lat = 42.450976, lon = -72.678154)
camp2 <- data.frame(lat = 42.458570, lon = -72.679581)
weather_stat1 <- data.frame(lat = 42.449653, lon = -72.680315)
weather_stat2 <- data.frame(Lat = 42.448470, lon = -72.680553)
```

### Data wrangling to find first proposed campsite:
```{r, warning=FALSE, message=FALSE}
streams_buffer <- macleish_streams %>%
  st_transform(proj4_aea) %>% #convert to meters
  st_buffer(dist = 61) %>% #Create buffer so we can see areas within 200 feet (61 meters) of a stream
  st_transform(4326) #change back to EPSG:4326 to plot it on leaflet

sbuffers_inside <- streams_buffer %>%
  st_intersection(macleish_boundary) #Find intersection with boundary so we are only looking at possible areas within Macleish

research_buffer <- macleish_research %>%
  st_transform(proj4_aea) %>%
  st_buffer(dist = 152) %>% #Create buffer so we can see areas within 500 feet (152 meters) of a research area
  st_transform(4326)

research_buffer2 <- macleish_research %>%
  st_transform(proj4_aea) %>%
  st_buffer(dist = 200) %>% #Create buffer so we can see areas within 650 feet (200 meters) of a research area
  st_transform(4326)

research_buffer_final <- research_buffer2 %>%
  st_difference(research_buffer) #join the buffers 500 and 650 feet from a research area so that we get areas at least 500 feet from a research area, and at most 650 feet from a research area.
rbuffers_inside <- research_buffer_final %>%
  st_intersection(macleish_boundary) #intersect joined buffers with macleish boundary so we only look at areas within Macleish.

challenge_buffer <- macleish_courses %>%
  st_transform(proj4_aea) %>% #convert to meters
  st_buffer(dist = 152) %>% #Create buffer so we can see areas within 500 feet (152 meters) of a challenge course
  st_transform(4326) #change back to EPSG:4326 to plot it on leaflet

challenge_buffer2 <- macleish_courses %>%
  st_transform(proj4_aea) %>%
  st_buffer(dist = 200) %>% #Create buffer so we can see areas within 650 feet (200 meters) of a challenge course
  st_transform(4326)

challenge_buffer_final <- challenge_buffer2 %>%
  st_difference(challenge_buffer) #join the buffers 500 and 650 feet from a challenge course so that we get areas at least 500 feet from a research area, and at most 650 feet from a research area.

cbuffers_inside <- challenge_buffer_final %>%
  st_intersection(macleish_boundary) #intersect joined buffers with macleish boundary so we only look at possible areas inside.



newsite1 <- data.frame(lat = 42.454198, lon = -72.685403)

leaflet() %>%
  addTiles() %>%
  addPolygons(data = macleish_forests, color = "purple") %>%
  addPolygons(data = rbuffers_inside, fillOpacity = .1, color = "blue") %>%
  addPolygons(data = cbuffers_inside, fillOpacity = .1, color = "yellow") %>%
  addPolygons(data = sbuffers_inside, fillOpacity = .1, color = "red") %>%
  addPolylines(data = macleish_contours, color = "green") %>%
  addPolylines(data = macleish_streams, color = "black") %>%
  addPolylines(data = macleish_trails, color = "black") %>%
  addPolygons(data = macleish_buildings, color = "black") %>%
  addMarkers(data = newsite1, popup = "Proposed Site 1") %>%
  addMarkers(data = camp1, popup = "Campsite 1") %>%
  addMarkers(data = camp2, popup = "Campsite 2") %>%
  addMarkers(data = weather_stat1, popup = "") %>%
  addMarkers(data = weather_stat2, popup = "") %>%
  addMarkers(data = macleish_landmarks, popup = "") %>%
  addPolygons(data = macleish_research, color = "orange") %>%
  addMarkers(data = macleish_courses, popup = "")

```


allbuffers_final <- bothbuffers_inside %>%
  st_intersection(sbuffers_inside) #Find areas that are within 200 ft of a stream, and 500 to 650 feet from a research area and challenge course
  
allbuffers_inside2 <- sbuffers_inside %>%
  st_intersection(cbuffers_inside) #Find areas that are within 200 ft of a stream, and 500 to 650 feet from a challenge course

### Data wrangling to find second proposed campsite:
```{r, warning=FALSE, message=FALSE}
challenge_buffer <- macleish_courses %>%
  st_transform(proj4_aea) %>% #convert to meters
  st_buffer(dist = 152) %>% #Create buffer so we can see areas within 500 feet (152 meters) of a challenge course
  st_transform(4326) #change back to EPSG:4326 to plot it on leaflet

challenge_buffer2 <- macleish_courses %>%
  st_transform(proj4_aea) %>%
  st_buffer(dist = 200) %>% #Create buffer so we can see areas within 650 feet (200 meters) of a challenge course
  st_transform(4326)

challenge_buffer_final <- challenge_buffer2 %>%
  st_join(challenge_buffer, join = st_intersects, left = FALSE) #join the buffers 500 and 650 feet from a challenge course so that we get areas at least 500 feet from a research area, and at most 650 feet from a research area.

cbuffers_inside <- challenge_buffer_final %>%
  st_intersection(macleish_boundary) #intersect joined buffers with macleish boundary so we only look at possible areas inside.

allbuffers_inside2 <- sbuffers_inside %>%
  st_intersection(cbuffers_inside) #Find areas that are within 200 ft of a stream, and 500 to 650 feet from a challenge course

newsite2 <- data.frame(lat = 42.450100, lon = -72.681583)

leaflet() %>%
  addTiles() %>%
  addPolygons(data = allbuffers_inside2) %>%
  addPolygons(data = macleish_forests, color = "purple") %>%
  addPolylines(data = macleish_contours, color = "green") %>%
  addPolylines(data = macleish_streams, color = "black") %>%
  addPolylines(data = macleish_trails, color = "red") %>%
  addPolygons(data = macleish_buildings, color = "black") %>%
  addMarkers(data = newsite1, popup = "Proposed Site 1") %>%
  addMarkers(data = camp1, popup = "Campsite 1") %>%
  addMarkers(data = camp2, popup = "Campsite 2") %>%
  addMarkers(data = newsite2, popup = "Proposed Site 2") %>%
  addMarkers(data = weather_stat1, popup = "damn") %>%
  addMarkers(data = weather_stat2, popup = "ugh") %>%
  addMarkers(data = macleish_landmarks, popup = "frig")
```









