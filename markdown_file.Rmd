---
title: "Markdown File"
author: "Marissa Freed, Natasha Rosenthal"
date: "3/26/2018"
output: 
  html_document:
    code_folding: hide
    df_print: paged
---
**make sure you `install.packages("macleish")` and `install.packages("leaflet")` before running code

http://download.massgis.digital.mass.gov/shapefiles/contours5k/hp337.zip

##Prompt: 
MacLeish currently has two campsites - one large group site closer to the building and one remote campsite with two tent platforms about one mile from the parking area. We would like to develop one additional campsite that is 
approximately 805 meters' walk from the parking area,

within 61 meters of a stream or other source of water, 

in forest that is unlike the forest in the two other campsites, 

relatively flat, and 

at least 152 meters from any research area or any element of the Challenge Course. 

Propose two new campsite locations for our consideration.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(macleish)
library(leaflet)
library(sf)
proj4_aea <- "+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"
```

```{r, eval = FALSE} 
url <- "http://download.massgis.digital.mass.gov/shapefiles/state/contours250k.zip"

local_file <- basename(url)

download.file(url, destfile = local_file)

unzip(local_file, exdir = "contours250k")
```

```{r, warning=FALSE}
macleish_landmarks <- macleish_layers[["landmarks"]]
macleish_trails <- macleish_layers[["trails"]]
macleish_streams <- macleish_layers[["streams"]]
macleish_forests <- macleish_layers[["forests"]]
macleish_courses <- macleish_layers[["challenge_courses"]]
macleish_boundary <- macleish_layers[["boundary"]]
macleish_contours <- macleish_layers[["contours_3m"]]
macleish_research <- macleish_layers[["research"]]
macleish_buildings <- macleish_layers[["buildings"]]
parking <- data.frame(lat = 42.448013, lon = -72.680663)
camp1 <- data.frame(lat = 42.450976, lon = -72.678154)
camp2 <- data.frame(lat = 42.458570, lon = -72.679581)
weather_stat1 <- data.frame(lat = 42.449653, lon = -72.680315)
weather_stat2 <- data.frame(Lat = 42.448470, lon = -72.680553)
```

```{r}
leaflet() %>%
  addTiles() %>%
  addPolylines(data = macleish_streams) %>%
  addPolygons(data = macleish_forests)
```

Data wrangling

```{r, warning=FALSE}
streams_buffer <- macleish_streams %>%
  st_transform(proj4_aea) %>% #convert to meters
  st_buffer(dist = 61) %>% #Create buffer so we can see areas within 200 feet (61 meters) of a stream
  st_transform(4326) #change back to EPSG:4326 to plot it on leaflet

sbuffers_inside <- streams_buffer %>%
  st_intersection(macleish_boundary) #Find intersection with boundary so we are only looking at possible areas within Macleish

research_buffer <- macleish_research %>%
  st_transform(proj4_aea) %>%
  st_buffer(dist = 152) %>% #Create buffer so we can see areas within 500 feet (152 meters) of a research area
  st_transform(4326)

research_buffer2 <- macleish_research %>%
  st_transform(proj4_aea) %>%
  st_buffer(dist = 200) %>% #Create buffer so we can see areas within 650 feet (200 meters) of a research area
  st_transform(4326)

research_buffer_final <- research_buffer2 %>%
  st_join(research_buffer, join = st_intersects, left = FALSE) #join the buffers 500 and 650 feet from a research area so that we get areas at least 500 feet from a research area, and at most 650 feet from a research area.
rbuffers_inside <- research_buffer_final %>%
  st_intersection(macleish_boundary) #intersect joined buffers with macleish boundary so we only look at areas within Macleish.

allbuffers_inside2 <- sbuffers_inside %>%
  st_intersection(rbuffers_inside) #Find areas that are within 200 ft of a stream, and 500 to 650 feet from a research area

newsite1 <- data.frame(lat = 42.454198, lon = -72.683603)

leaflet() %>%
  addTiles() %>%
  addPolygons(data = macleish_forests, color = "yellow") %>%
  addPolygons(data = allbuffers_inside2) %>%
  addPolylines(data = macleish_contours, color = "green") %>%
  addPolylines(data = macleish_streams, color = "brown") %>%
  addPolylines(data = macleish_trails, color = "red") %>%
  addPolygons(data = macleish_buildings, color = "black") %>%
  addMarkers(data = newsite1, popup = "Proposed Site 1") %>%
  addMarkers(data = camp1, popup = "Campsite 1") %>%
  addMarkers(data = camp2, popup = "Campsite 2")
```

```{r}
challenge_buffer <- macleish_courses %>%
  st_transform(proj4_aea) %>% #convert to meters
  st_buffer(dist = 152) %>% #Create buffer so we can see areas within 500 feet (152 meters) of a challenge course
  st_transform(4326) #change back to EPSG:4326 to plot it on leaflet
cbuffers_inside <- challenge_buffer %>%
  st_intersection(macleish_boundary) #Find intersection with boundary so we are only looking at possible areas within Macleish

allbuffers_inside <- sbuffers_inside %>%
  st_intersection(cbuffers_inside)
```









